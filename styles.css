/* 
 * Equation Studio - Styles
 * Visual LaTeX formula editor for Obsidian
 */

/* ── KaTeX fonts for MathLive ────────────────────────────────────────────
   MathLive renders symbols like ≠ using Private-Use-Area glyphs that only
   exist in KaTeX fonts.  Loading them here via @font-face + the
   --ML__static-fonts flag is the most reliable method inside Obsidian's
   Electron shell (avoids CSP / fetch issues with dynamic JS loading). */

@font-face { font-display: swap; font-family: KaTeX_AMS;         font-style: normal;  font-weight: 400; src: url('https://cdn.jsdelivr.net/npm/mathlive@0.101.2/dist/fonts/KaTeX_AMS-Regular.woff2')         format('woff2'); }
@font-face { font-display: swap; font-family: KaTeX_Caligraphic; font-style: normal;  font-weight: 700; src: url('https://cdn.jsdelivr.net/npm/mathlive@0.101.2/dist/fonts/KaTeX_Caligraphic-Bold.woff2')    format('woff2'); }
@font-face { font-display: swap; font-family: KaTeX_Caligraphic; font-style: normal;  font-weight: 400; src: url('https://cdn.jsdelivr.net/npm/mathlive@0.101.2/dist/fonts/KaTeX_Caligraphic-Regular.woff2') format('woff2'); }
@font-face { font-display: swap; font-family: KaTeX_Fraktur;     font-style: normal;  font-weight: 700; src: url('https://cdn.jsdelivr.net/npm/mathlive@0.101.2/dist/fonts/KaTeX_Fraktur-Bold.woff2')        format('woff2'); }
@font-face { font-display: swap; font-family: KaTeX_Fraktur;     font-style: normal;  font-weight: 400; src: url('https://cdn.jsdelivr.net/npm/mathlive@0.101.2/dist/fonts/KaTeX_Fraktur-Regular.woff2')     format('woff2'); }
@font-face { font-display: swap; font-family: KaTeX_Main;        font-style: italic;  font-weight: 700; src: url('https://cdn.jsdelivr.net/npm/mathlive@0.101.2/dist/fonts/KaTeX_Main-BoldItalic.woff2')     format('woff2'); }
@font-face { font-display: swap; font-family: KaTeX_Main;        font-style: normal;  font-weight: 700; src: url('https://cdn.jsdelivr.net/npm/mathlive@0.101.2/dist/fonts/KaTeX_Main-Bold.woff2')           format('woff2'); }
@font-face { font-display: swap; font-family: KaTeX_Main;        font-style: italic;  font-weight: 400; src: url('https://cdn.jsdelivr.net/npm/mathlive@0.101.2/dist/fonts/KaTeX_Main-Italic.woff2')         format('woff2'); }
@font-face { font-display: swap; font-family: KaTeX_Main;        font-style: normal;  font-weight: 400; src: url('https://cdn.jsdelivr.net/npm/mathlive@0.101.2/dist/fonts/KaTeX_Main-Regular.woff2')        format('woff2'); }
@font-face { font-display: swap; font-family: KaTeX_Math;        font-style: italic;  font-weight: 700; src: url('https://cdn.jsdelivr.net/npm/mathlive@0.101.2/dist/fonts/KaTeX_Math-BoldItalic.woff2')     format('woff2'); }
@font-face { font-display: swap; font-family: KaTeX_Math;        font-style: italic;  font-weight: 400; src: url('https://cdn.jsdelivr.net/npm/mathlive@0.101.2/dist/fonts/KaTeX_Math-Italic.woff2')         format('woff2'); }
@font-face { font-display: swap; font-family: KaTeX_SansSerif;   font-style: normal;  font-weight: 700; src: url('https://cdn.jsdelivr.net/npm/mathlive@0.101.2/dist/fonts/KaTeX_SansSerif-Bold.woff2')      format('woff2'); }
@font-face { font-display: swap; font-family: KaTeX_SansSerif;   font-style: italic;  font-weight: 400; src: url('https://cdn.jsdelivr.net/npm/mathlive@0.101.2/dist/fonts/KaTeX_SansSerif-Italic.woff2')    format('woff2'); }
@font-face { font-display: swap; font-family: KaTeX_SansSerif;   font-style: normal;  font-weight: 400; src: url('https://cdn.jsdelivr.net/npm/mathlive@0.101.2/dist/fonts/KaTeX_SansSerif-Regular.woff2')   format('woff2'); }
@font-face { font-display: swap; font-family: KaTeX_Script;      font-style: normal;  font-weight: 400; src: url('https://cdn.jsdelivr.net/npm/mathlive@0.101.2/dist/fonts/KaTeX_Script-Regular.woff2')      format('woff2'); }
@font-face { font-display: swap; font-family: KaTeX_Size1;       font-style: normal;  font-weight: 400; src: url('https://cdn.jsdelivr.net/npm/mathlive@0.101.2/dist/fonts/KaTeX_Size1-Regular.woff2')       format('woff2'); }
@font-face { font-display: swap; font-family: KaTeX_Size2;       font-style: normal;  font-weight: 400; src: url('https://cdn.jsdelivr.net/npm/mathlive@0.101.2/dist/fonts/KaTeX_Size2-Regular.woff2')       format('woff2'); }
@font-face { font-display: swap; font-family: KaTeX_Size3;       font-style: normal;  font-weight: 400; src: url('https://cdn.jsdelivr.net/npm/mathlive@0.101.2/dist/fonts/KaTeX_Size3-Regular.woff2')       format('woff2'); }
@font-face { font-display: swap; font-family: KaTeX_Size4;       font-style: normal;  font-weight: 400; src: url('https://cdn.jsdelivr.net/npm/mathlive@0.101.2/dist/fonts/KaTeX_Size4-Regular.woff2')       format('woff2'); }
@font-face { font-display: swap; font-family: KaTeX_Typewriter;  font-style: normal;  font-weight: 400; src: url('https://cdn.jsdelivr.net/npm/mathlive@0.101.2/dist/fonts/KaTeX_Typewriter-Regular.woff2')  format('woff2'); }

/* CSS Variables for theming */
:root {
    /* Tell MathLive the fonts are pre-loaded — skip its dynamic JS loader */
    --ML__static-fonts: true;
    --ml-primary: #D97706;
    --ml-primary-hover: #B45309;
    --ml-primary-light: #FEF3C7;
    --ml-background: #FFFFFF;
    --ml-surface: #F9FAFB;
    --ml-surface-elevated: #FFFFFF;
    --ml-border: #E5E7EB;
    --ml-border-focus: #D97706;
    --ml-text-primary: #111827;
    --ml-text-secondary: #6B7280;
    --ml-text-muted: #9CA3AF;
    --ml-shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
    --ml-shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
    --ml-shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
    --ml-radius-sm: 6px;
    --ml-radius-md: 8px;
    --ml-radius-lg: 12px;
    --ml-transition: all 0.15s ease;
}

/* Dark theme */
.theme-dark {
    --ml-primary: #F59E0B;
    --ml-primary-hover: #FBBF24;
    --ml-primary-light: rgba(245, 158, 11, 0.15);
    --ml-background: #1F2937;
    --ml-surface: #111827;
    --ml-surface-elevated: #374151;
    --ml-border: #374151;
    --ml-border-focus: #F59E0B;
    --ml-text-primary: #F9FAFB;
    --ml-text-secondary: #D1D5DB;
    --ml-text-muted: #6B7280;
    --ml-shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.3);
    --ml-shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.4), 0 2px 4px -2px rgb(0 0 0 / 0.3);
    --ml-shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.4), 0 4px 6px -4px rgb(0 0 0 / 0.3);
}

/* Modal Styling */
.mathlive-enhanced-modal {
    max-width: 900px !important;
    width: 90vw !important;
    max-height: 85vh !important;
}

.mathlive-enhanced-modal .modal-content {
    padding: 0 !important;
    background: var(--ml-background);
    border-radius: var(--ml-radius-lg);
    overflow: hidden;
}

.mathlive-enhanced-container {
    display: flex;
    flex-direction: column;
    height: 100%;
    background: var(--ml-background);
}

/* Header */
.mathlive-header {
    padding: 20px 24px;
    border-bottom: 1px solid var(--ml-border);
    background: var(--ml-surface);
}

.mathlive-title-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 16px;
}

.mathlive-title {
    margin: 0;
    font-size: 20px;
    font-weight: 600;
    color: var(--ml-text-primary);
    letter-spacing: -0.02em;
}

/* Mode Toggle */
.mathlive-mode-toggle {
    display: flex;
    background: var(--ml-border);
    border-radius: var(--ml-radius-md);
    padding: 3px;
    gap: 2px;
}

.mathlive-mode-btn {
    padding: 8px 16px;
    font-size: 13px;
    font-weight: 500;
    border: none;
    background: transparent;
    color: var(--ml-text-secondary);
    border-radius: var(--ml-radius-sm);
    cursor: pointer;
    transition: var(--ml-transition);
}

.mathlive-mode-btn:hover {
    color: var(--ml-text-primary);
}

.mathlive-mode-btn.active {
    background: var(--ml-surface-elevated);
    color: var(--ml-text-primary);
    box-shadow: var(--ml-shadow-sm);
}

/* Main Content Layout */
.mathlive-main-content {
    display: flex;
    flex: 1;
    min-height: 0;
    overflow: hidden;
}

/* Show Keyboard Button */
.mathlive-show-kb-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    padding: 8px 16px;
    font-size: 13px;
    font-weight: 500;
    border: 1px solid var(--ml-border);
    background: var(--ml-surface-elevated);
    color: var(--ml-text-secondary);
    border-radius: var(--ml-radius-md);
    cursor: pointer;
    transition: var(--ml-transition);
    align-self: flex-start;
}

.mathlive-show-kb-btn:hover {
    border-color: var(--ml-primary);
    color: var(--ml-primary);
}

/* Editor Area */
.mathlive-editor-area {
    flex: 1;
    padding: 24px;
    display: flex;
    flex-direction: column;
    gap: 20px;
    overflow-y: auto;
    background: var(--ml-background);
}

/* Mathfield Container */
.mathlive-mathfield-container {
    position: relative;
    background: var(--ml-surface);
    border: 2px solid var(--ml-border);
    border-radius: var(--ml-radius-lg);
    padding: 20px;
    min-height: 120px;
    transition: var(--ml-transition);
}

.mathlive-mathfield-container:focus-within {
    border-color: var(--ml-border-focus);
    box-shadow: 0 0 0 3px var(--ml-primary-light);
}

.mathlive-mathfield {
    width: 100%;
    min-height: 80px;
    background: transparent !important;
    border: none !important;
    outline: none !important;
    pointer-events: auto !important;
    user-select: text !important;
    --caret-color: var(--ml-primary);
}

/* MathLive internal styling overrides */
.mathlive-mathfield::part(content) {
    padding: 8px 0;
}

.mathlive-mathfield::part(virtual-keyboard-toggle) {
    display: none;
}

/* Hide MathLive's built-in menu toggle (non-functional in modal context) */
.mathlive-mathfield::part(menu-toggle) {
    display: none;
}

/* Quick Templates Strip */
.mathlive-quick-templates {
    border: 1px solid var(--ml-border);
    border-radius: var(--ml-radius-md);
    background: var(--ml-surface);
    overflow: hidden;
}

.mathlive-quick-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 6px 12px;
    border-bottom: 1px solid var(--ml-border);
    background: var(--ml-surface);
}

.mathlive-quick-title {
    font-size: 11px;
    font-weight: 600;
    color: var(--ml-text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.mathlive-quick-hide-btn {
    font-size: 11px;
    padding: 2px 8px;
    border: 1px solid var(--ml-border);
    background: var(--ml-surface-elevated);
    color: var(--ml-text-muted);
    border-radius: var(--ml-radius-sm);
    cursor: pointer;
    transition: var(--ml-transition);
}

.mathlive-quick-hide-btn:hover {
    color: var(--ml-text-primary);
    border-color: var(--ml-primary);
}

.mathlive-quick-body {
    padding: 8px 12px;
    display: flex;
    flex-direction: column;
    gap: 6px;
}

.mathlive-quick-body.is-hidden {
    display: none;
}

.mathlive-quick-row {
    display: flex;
    align-items: center;
    gap: 8px;
}

.mathlive-quick-row-label {
    font-size: 11px;
    font-weight: 600;
    color: var(--ml-text-muted);
    white-space: nowrap;
}

.mathlive-quick-btns {
    display: flex;
    flex-wrap: wrap;
    gap: 4px;
}

.mathlive-quick-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 32px;
    height: 32px;
    font-size: 16px;
    border: 1px solid var(--ml-border);
    background: var(--ml-surface-elevated);
    color: var(--ml-text-primary);
    border-radius: var(--ml-radius-sm);
    cursor: pointer;
    transition: var(--ml-transition);
    padding: 0;
}

.mathlive-quick-btn:hover {
    border-color: var(--ml-primary);
    background: var(--ml-primary-light);
    color: var(--ml-primary);
}

/* Label */
.mathlive-label {
    font-size: 12px;
    font-weight: 600;
    color: var(--ml-text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

/* Recent Formulas */
.mathlive-recent-section {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.mathlive-recent-list {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}

.mathlive-recent-chip {
    padding: 6px 12px;
    font-size: 12px;
    border: 1px solid var(--ml-border);
    background: var(--ml-surface-elevated);
    color: var(--ml-text-secondary);
    border-radius: 20px;
    cursor: pointer;
    transition: var(--ml-transition);
    max-width: 150px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.mathlive-recent-chip:hover {
    border-color: var(--ml-primary);
    background: var(--ml-primary-light);
    color: var(--ml-primary);
}

/* Action Buttons */
.mathlive-actions {
    display: flex;
    justify-content: flex-end;
    gap: 12px;
    padding: 16px 24px;
    border-top: 1px solid var(--ml-border);
    background: var(--ml-surface);
}

.mathlive-btn {
    padding: 10px 20px;
    font-size: 14px;
    font-weight: 500;
    border-radius: var(--ml-radius-md);
    cursor: pointer;
    transition: var(--ml-transition);
    border: none;
}

.mathlive-btn-primary {
    background: var(--ml-primary);
    color: white;
}

.mathlive-btn-primary:hover {
    background: var(--ml-primary-hover);
}

.mathlive-btn-secondary {
    background: transparent;
    color: var(--ml-text-secondary);
    border: 1px solid var(--ml-border);
}

.mathlive-btn-secondary:hover {
    background: var(--ml-surface);
    color: var(--ml-text-primary);
}

/* Virtual Keyboard Styling */
.ML__keyboard {
    --keyboard-background: var(--ml-surface) !important;
    --keyboard-border: var(--ml-border) !important;
    --keycap-background: var(--ml-surface-elevated) !important;
    --keycap-border: var(--ml-border) !important;
    --keycap-text: var(--ml-text-primary) !important;
    --keycap-text-active: var(--ml-primary) !important;
    --keycap-background-hover: var(--ml-primary-light) !important;
    --keycap-background-active: var(--ml-primary) !important;
    border-radius: var(--ml-radius-lg) !important;
    box-shadow: var(--ml-shadow-lg) !important;
}

/* Responsive Design */
@media (max-width: 768px) {
    .mathlive-enhanced-modal {
        width: 95vw !important;
        max-width: none !important;
    }
    
    .mathlive-title-row {
        flex-direction: column;
        align-items: stretch;
    }
    
    .mathlive-mode-toggle {
        justify-content: center;
    }
    
    .mathlive-editor-area {
        padding: 16px;
    }
}

/* Animations */
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
}

.mathlive-enhanced-modal {
    animation: fadeIn 0.2s ease-out;
}

/* Focus states for accessibility */
.mathlive-mode-btn:focus-visible,
.mathlive-show-kb-btn:focus-visible,
.mathlive-quick-btn:focus-visible,
.mathlive-quick-hide-btn:focus-visible,
.mathlive-recent-chip:focus-visible,
.mathlive-btn:focus-visible {
    outline: 2px solid var(--ml-primary);
    outline-offset: 2px;
}

/* Scrollbar styling */
.mathlive-editor-area::-webkit-scrollbar {
    width: 6px;
}

.mathlive-editor-area::-webkit-scrollbar-track {
    background: transparent;
}

.mathlive-editor-area::-webkit-scrollbar-thumb {
    background: var(--ml-border);
    border-radius: 3px;
}

.mathlive-editor-area::-webkit-scrollbar-thumb:hover {
    background: var(--ml-text-muted);
}
